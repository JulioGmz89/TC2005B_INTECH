<%- include('./includes/head')%>


<body id="page-top">
	<div id="wrapper">
		<%- include('./includes/sidebar')%>
		<!-- Todo excepto sidebar -->
		<div class="d-flex flex-column" id="content-wrapper">
			<!-- Contenido excepto footer -->
			<div id="content">
				<%- include('./includes/topbar')%>
				<!-- Contenido de casos de uso -->
				<div class="container-fluid">
					<!-- Titulo del proyecto -->
					<div class="row">
						<div class="col">
							<h3 class="text-dark mb-4"><%//nombreProyecto%></h3>
						</div>
					</div>
					<!-- Tarjeta para casos de uso -->
					<div class="row">
						<div class="col">
							<div class="card shadow">
								<!-- Header de la tarjeta  -->
								<div class="card-header py-3">
									<div class="row">
										<div class="col d-xl-flex align-items-xl-center">
											<p class="lead text-white m-0 font-weight-bold">Casos de uso</p>
										</div>
										<div class="col">
											<!-- Boton para agregar caso de uso -->
											<button class="btn btn-primary border rounded border-primary d-flex float-right justify-content-end justify-content-xl-center align-items-xl-center" type="button" data-toggle="modal" data-target="#crearCasoUso">
												<label class="m-0">Agregar</label>
											</button>
											
											<!-- Modal que hace pop up para agregar caso de uso -->
											<div class="modal fade" id="crearCasoUso" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
												<div class="modal-dialog modal-dialog-centered" role="document">
													<div class="modal-content bg-dark text-almostWhite">
														<!-- Header Modal -->
														<div class="modal-header">
															<h5 class="modal-title" id="exampleModalLongTitle">Crear caso de uso</h5>
															<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																<span aria-hidden="true">&times;</span>
															</button>
														</div>
														<!-- Cuerpo modal -->
														<form action="casos-uso" method="POST">
															<!-- <input type="hidden" name="_csrf" value="<%= //csrfToken %>" > -->
															<div class="modal-body">
																<div class="form-group">
																	<label for="NombreCU">Nombre del caso de uso</label>
																	<input name="nombreCaso" type="text" class="form-control form-input bg-transparent" id="NombreCU" placeholder="Nombre del caso de uso">
																</div>
																<!-- Contenedor con iteracion y complejidad -->
																<div class="container">
																	<div class="row">
																		<div class="col-sm">
																			<label for="Iteracion">Iteracion</label>
																			<input name="iteracion" type="number" class="form-control form-input bg-transparent" id="Iteracion">
																		</div>
																		<div class="col-sm">
																			<label for="integrantes">Complejidad</label>
																			<select name="complejidad" class="form-control bg-transparent text-almostWhite" id="complejidad">
																				<option class="">1</option>
																				<option>2</option>
																				<option>3</option>
																				<option>5</option>
																				<option>8</option>
																				<option>13</option>
																			</select>
																		</div>
																	</div>
																</div>
															</div>
															<!-- Footer modal -->
															<div class="modal-footer border-0">
																<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
																<input type="submit" class="btn btn-primary" value="Guardar">
															</div>
														</form>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- Cuerpo de la tarjeta de casos de uso -->
								<div class="card-body">
									<!-- Filtros para mostrar datos -->
									<div class="row">
										<!-- Show cierta cantidad de datos -->
										<div class="col-md-6 text-nowrap">
											<div id="dataTable_length" class="dataTables_length" aria-controls="dataTable">
												<label>Show&nbsp;
													<select class="form-control form-control-sm custom-select custom-select-sm">
														<option value="10" selected="">10</option>
														<option value="25">25</option>
														<option value="50">50</option>
														<option value="100">100</option>
													</select>&nbsp;
												</label>
											</div>
										</div>
										<!-- Buscador -->
										<div class="col-md-6">
											<div class="text-md-right dataTables_filter" id="dataTable_filter">
												<label>
													<input type="search" class="form-control form-control-sm" aria-controls="dataTable" placeholder="Search">
												</label>
											</div>
										</div>
									</div>
									<!-- Tabla de casos de uso -->
									<div class="table-responsive table mt-2" id="dataTable-1" role="grid" aria-describedby="dataTable_info">
										<table class="table table-hover table-dark my-0" id="dataTable">
											<!-- Headers -->
											<thead>
												<tr>
													<th class="text-center"><strong>Nombre</strong></th>
													<th class="text-center"><strong>Asignado</strong></th>
													<th class="text-center"><strong>Iteración</strong></th>
													<th class="text-center"><strong>Fecha de inicio</strong></th>
													<th class="text-center"><strong>Fecha final</strong></th>
													<th class="text-center"><strong>Progreso</strong></th>
													<th class="text-center"><strong>Tiempo real</strong></th>
												</tr>
											</thead>
											<!-- Body tabla de CU -->
											<tbody>
												<% for (let i=0; i<casosUso.length; i++) { %>
													<tr>
														<!-- Nombre del CU con boton y modal -->
														<td>
															<button class="btn" data-toggle="modal" data-target="#casoUso">
																<%= casosUso[i].nombre_caso %>
															</button>
															<!-- Modal para seleccionar tareas -->
															<div class="modal fade" id="casoUso" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
																<div class="modal-dialog modal-dialog-centered" role="document">
																	<div class="modal-content bg-dark text-almostWhite">
																		<div class="modal-header">
																			<h5 class="modal-title" id="exampleModalLongTitle">Seleccion de tareas</h5>
																			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
																				<span aria-hidden="true">&times;</span>
																			</button>
																		</div>
																		<!-- Seleccion de tareas -->
																		<!-- TODO Convertir a modo js para la seleccion de tareas -->
																		<div class="modal-body">
																			<form>
																				<div class="container">
																					<div class="row">
																						<% tareas.forEach( tarea =>{ %> 
																						<div class="col-4">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									<%- tarea.nombre_tarea; %> 
																								</label>
																							</div>
																						</div>
																						<% }); %> 
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 2
																								</label>
																							</div>
															
																						</div>
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 3
																								</label>
																							</div>
																						</div>
																					</div>
																					<div class="row">
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 4
																								</label>
																							</div>
																						</div>
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 5
																								</label>
																							</div>
															
																						</div>
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 6
																								</label>
																							</div>
															
																						</div>
																					</div>
																					<div class="row">
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 7
																								</label>
																							</div>
																						</div>
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 8
																								</label>
																							</div>
															
																						</div>
																						<div class="col-sm">
																							<div class="form-check">
																								<input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
																								<label class="form-check-label" for="flexCheckDefault">
																									Tarea 9
																								</label>
																							</div>
																						</div>
																					</div>
																				</div>
																			</form>
																		</div>
																		
																		<!-- Modal footer -->
																		<div class="modal-footer border-0">
																			<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
																			<button type="button" class="btn btn-primary">Guardar</button>
																		</div>
																	</div>
																</div>
															</div>
															</div>
														</td>
														<!-- Integrantes -->
														<td>
															<% for( let j=0; j<casosUso[i].integrantes.length; j++ ) { %>
																<span>
																	<%= casosUso[i].integrantes[j].nombre_usuario %>, 
																</span> 
															<% } %>
														</td>
														<!-- Iteracion -->
														<td class="text-center"><%= casosUso[i].iteracion_caso %></td>
														<!-- Fecha de inicio -->
														<td><%= casosUso[i].fechaInicio_caso %></td>
														<!-- Fecha final  -->
														<td><%= casosUso[i].fechaFinal_caso %></td>
														<!-- Barra de progreso -->
														<td>
															<div class="progress">
																<div class="progress-bar bg-success" aria-valuenow="82"
																	aria-valuemin="0" aria-valuemax="100"
																	style="width: 82%;">
																	<%//casoUso[i].tareasCompletadas%>
																</div>
															</div>
														</td>
														<!-- Tiempo real -->
														<td class="text-center">-</td>
													</tr>
												<% } %>
											</tbody>
											<tfoot>
												<tr>
													<td class="text-center"><strong>Nombre</strong></td>
													<td class="text-center"><strong>Asignado</strong></td>
													<td class="text-center"><strong>Iteración</strong></td>
													<td class="text-center"><strong>Fecha de inicio</strong></td>
													<td class="text-center"><strong>Fecha final</strong></td>
													<td class="text-center"><strong>Progreso</strong></td>
													<td class="text-center"><strong>Tiempo real</strong></td>
												</tr>
											</tfoot>
										</table>
									</div>
									<div class="row">
										<div class="col-md-6 align-self-center">
											<p id="dataTable_info" class="dataTables_info" role="status"
												aria-live="polite">Showing 1 to 10 of 27</p>
										</div>
										<div class="col-md-6">
											<nav
												class="d-lg-flex justify-content-lg-end dataTables_paginate paging_simple_numbers">
												<ul class="pagination">
													<li class="page-item disabled"><a class="page-link" href="#"
															aria-label="Previous"><span aria-hidden="true">«</span></a>
													</li>
													<li class="page-item active"><a class="page-link" href="#">1</a>
													</li>
													<li class="page-item"><a class="page-link" href="#">2</a></li>
													<li class="page-item"><a class="page-link" href="#">3</a></li>
													<li class="page-item"><a class="page-link" href="#"
															aria-label="Next"><span aria-hidden="true">»</span></a></li>
												</ul>
											</nav>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
<%- include('./includes/footer')%>
