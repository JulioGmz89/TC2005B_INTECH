<%- include('./includes/head')%>

<body id="page-top">
	
	<script src="/js/JSON.js"></script>
	<script src="/js/cookieManager.js"></script>
	<script src="/js/airtableAPI.js"></script>
	<script src="/js/charts.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const integrantes = [];
			<% for( let i = 0; i < integrantes.length; i++ ) { %>
				integrantes.push('<%- integrantes[i].email_usuario %>');
			<% } %>
			const proyectoData = {
				integrantes: integrantes
			};
			localStorage.setItem(`proyecto_${<%- proyecto.id_proyecto %>}`, JSON.stringify(proyectoData));
		});

		// Gracifas
		let estimaciones = new Estimaciones('<%- proyecto.id_proyecto %>');
	</script>


	<div id="wrapper">
		<%- include('./includes/sidebar')%>
		
		<!-- Todo excepto sidbar -->
		<div class="d-flex flex-column" id="content-wrapper">
			<!-- Contenido excepto footer -->
			<div id="content">
				<%- include('./includes/topbar')%>
				<!-- Contenido sin la top navbar -->
				<div class="container-fluid justify-content-between align-items-center">

					<!-- Contenedor con titulo, descripcion y detalles del proyecto como header -->
					<!-- <div class="container-fluid justify-content-between align-items-center mb-4 mx-0 px-4"> -->
					<div class="row">
						<div class="col">
							<div class="row mx-4 my-3">
								<h2 class="h2 text-dark mb-0">
									<%- proyecto.nombre_proyecto%>
								</h2>
								<button class="btn mx-2" data-toggle="modal" data-target="#modificarProyecto">
									<i class="bi bi-pencil"></i>
								</button>
								<!-- Modal pop up para modificar proyecto -->
								<div class="modal fade" id="modificarProyecto" tabindex="-1" role="dialog" aria-labelledby="modificarProyecto" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered" role="document">
										<div class="modal-content bg-dark text-almostWhite">
											<div class="modal-header">
												<h5 class="modal-title" id="exampleModalLongTitle">Editar proyecto</h5>
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span class="text-light" aria-hidden="true">&times;</span>
												</button>
											</div>
											
											<!-- Form para modificar proyecto -->
											<form action="/proyecto/<%= proyecto.id_proyecto %>/" method="POST">
												<div class="modal-body">
													<input type="hidden" name="_csrf" value="<%= csrfToken %>" >
													<!-- Nombre del proyecto -->
													<label for="NombreProyecto">Nombre del proyecto</label>
													<input type="text" class="form-control bg-transparent text-almostWhite form-input" id="NombreProyecto" placeholder="Nombre del proyecto" name="nombreProyecto" value="<%- proyecto.nombre_proyecto%>">
													<!-- Nombre del cliente -->
													<div class="form-group">
														<label for="NombreCliente">Nombre del cliente</label>
														<input type="text" class="form-control bg-transparent text-almostWhite form-input" id="NombreCliente" name="clienteProyecto" placeholder="Nombre del cliente" value="<%- cliente %> ">
													</div>
													<!-- Integrantes -->
													<div class="form-group">
														<label for="integrantes">Integrantes</label>
														<div class="bg-dark text-almostWhite overflow-auto p-3 mb-3 mb-md-0 mr-md-3" style=" max-height: 100px;">
															
															<% usuario.forEach ( usr=>{ %>
												
																<div class="form-check">
																	<input class="form-check-input" type="checkbox" value="<%- usr.email_usuario %>" name="id_usuario_<%- usr.email_usuario %>" id="defaultCheck1"
																		<% if ( usuariosIntegrantes.includes(usr.email_usuario) ) { %>
																			checked
																		<% } %> >
																	<label class="form-check-label" for="defaultCheck1">
																		<%- usr.nombre_usuario %>
																	</label>
																</div>
																
															<%});%>

														</div>
													</div>
													<!-- Descripcion del proyecto -->
													<div class="form-group">
														<label for="DescripcionProyecto">Descripcion del proyecto</label>
														<textarea class="form-control bg-transparent text-almostWhite form-input" name="descripcionProyecto" id="floatingTextarea">
															<%= descripcion %>
														</textarea>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
													<input  type="submit" value="Guardar"class="btn btn-primary">
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<div class="row mx-4 my-2">
								<h6 class="text-dark mb-0">
									Fecha inicio: <%- fechaInicio%>
								</h6>
							</div>
							<div class="row mx-4 my-2">
								<h6 class="text-dark mb-0">
									Cliente: <%- cliente%>
								</h6>
							</div>
							<div class="col p-0">
							</div>

						</div>
						<div class="col-4 text-right">
							<h6 class="text-dark mb-0">
								Tareas completadas: <%- tareasCompletadas %>
							</h6>
						</div>
						<div class="row mx-3 mb-3 align-items-center">
						</div>
						
					</div>

					<!-- Contenedor row con tareas completadas, integrantes, tiempo estimado y descripcion -->
					<div class="row">
						<div class="col-lg-6 offset-xl-0 mb-4">
							
							<!-- Tarjeta para las tareas completadas -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<h6 class="h6 text-white m-0 font-weight-bold">Tareas completadas</h6>
								</div>
								<div class="card-body">
									<div class="card py-2 m-0">
										<div class="card-body bg-gris-fondo">
											<div class="row align-items-center no-gutters">
												<div class="col mr-3">
													<div class="row no-gutters align-items-center">
														<div class="col-auto">
															<div
																class="text-dark font-weight-bold h5 mb-0 mr-3">
																<span>
																	<%= (tareasTotales == 0)? 0 : Math.round((tareasCompletadas/tareasTotales)*100) %>%
																</span>
															</div>
														</div>
														<div class="col">
															<div class="progress progress-sm mb-0">
																<div class="progress-bar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100"
																	style="width: <%- (tareasCompletadas/tareasTotales)*100 %>%">
																</div>
															</div>
														</div>
													</div>
												</div>
												<div class="col-auto">
													<i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Tarjeta para la grafica de tiempo estimado -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<h6 class="text-white font-weight-bold m-0">Tiempo estimado</h6>
								</div>
								<div class="card-body">
									<div class="chart-area">
										<canvas id="estimation-chart"></canvas>
										<script>
											document.addEventListener('DOMContentLoaded', async () => {
												const config = await estimaciones.estimacionesLineChartData();
												var myChart = new Chart(document.getElementById('estimation-chart'), config);
											});
										</script>
									</div>
								</div>
							</div>

						</div>

						<div class="col-lg-6 offset-xl-0 mb-4">
							<!-- Contenedor para la tarjeta de integrantes general  -->
							<div class="row">
								<div class="col">
									<!-- Tarjeta para integrantes general -->
									<div class="card shadow mb-4">
										<div class="card-header py-3">
											<h6 class="text-white m-0 font-weight-bold">Integrantes</h6>
										</div>
										<div class="card-body py-2">
											<% integrantes.forEach ( integrante=>{ %>
												
												<!-- Tarjeta para integrante individual -->
												<div class="card shadow border-left-primary py-2 my-2">
													<div class="card-body p-0 bg-gris-fondo d-flex	">
														<div class="row align-items-center no-gutters">
															<div class="col mr-2">
																<div class="text-dark p mb-0">
																	<span>
																		<%- integrante.nombre_usuario %>
																	</span>
																</div>
															</div>
														</div>
													</div>
												</div>
												
											<%});%>
										</div>
									</div>
								</div>
							</div>
							<!-- Contenedor para la tarjeta de descripcion del proyecto  -->
							<div class="row">
								<div class="col">
									<!-- Tarjeta para la descripcion del proyecto -->
									<div class="card shadow mb-4">
										<div class="card-header py-3">
											<h6 class="text-white m-0 font-weight-bold">Descripción</h6>
										</div>
										<div class="card-body">
											<p class="m-0">
												<%= descripcion %>
											</p>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Contenedor row de progreso de tareas y carga de trabajo -->
					<div class="row">
						<div class="col-6">
							<!-- Tarjeta de grafica progreso de tareas -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<h6 class="text-white m-0 font-weight-bold">Progreso de tareas</h6>
								</div>
								<div class="card-body">
									<div class="chart-area">
										<canvas id="progress-task"></canvas>
										<script>
											document.addEventListener('DOMContentLoaded', async () => {
												// let data = {
												// 	labels: [
												// 		'Red',
												// 		'Blue',
												// 		'Yellow'
												// 	],
												// 	datasets: [{
												// 		label: "grafica",
												// 		data: [110, 200, 300],
												// 		backgroundColor: [
												// 			'rgb(255, 99, 132)',
												// 			'rgb(54, 162, 235)',
												// 			'rgb(255, 205, 86)'
												// 			],
												// 			hoverOffset: 4}]};
												
												// const config = {
												// type: 'pie',
												// data: data,
												// };
												const config = await estimaciones.estimacionesPieChartData();
												var myChart = new Chart(document.getElementById('progress-task'), config);
											});
										</script>
									</div>
								</div>
							</div>
						</div>
						<div class="col-6">
							<!-- Tarjeta de gráfica de carga de trabajo -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<h6 class="text-white m-0 font-weight-bold">Carga de trabajo</h6>
								</div>
								<div class="card-body">
									<div class="chart-area">
										<canvas data-bss-chart="{&quot;type&quot;:&quot;bar&quot;,&quot;data&quot;:{&quot;labels&quot;:[&quot;Julio&quot;,&quot;Edgar&quot;,&quot;Paulina&quot;,&quot;Adriana&quot;,&quot;Daniel&quot;],&quot;datasets&quot;:[{&quot;label&quot;:&quot;Tareas&quot;,&quot;backgroundColor&quot;:&quot;#4e73df&quot;,&quot;borderColor&quot;:&quot;#4e73df&quot;,&quot;data&quot;:[&quot;15&quot;,&quot;13&quot;,&quot;22&quot;,&quot;16&quot;,&quot;19&quot;]}]},&quot;options&quot;:{&quot;maintainAspectRatio&quot;:false,&quot;legend&quot;:{&quot;display&quot;:false},&quot;title&quot;:{},&quot;scales&quot;:{&quot;xAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;],&quot;drawOnChartArea&quot;:false},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;beginAtZero&quot;:true,&quot;padding&quot;:20}}],&quot;yAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;]},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;beginAtZero&quot;:true,&quot;padding&quot;:20}}]}}}"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Contenedor para grafica de progreso de casos de uso -->
					<div class="row">
						<div class="col">
							<!-- Tarjeta de grafica de progreso de casos de uso -->
							<div class="card shadow mb-4">
								<div class="card-header py-3">
									<h6 class="text-white m-0 font-weight-bold">Progreso casos de uso</h6>
								</div>
								<div class="card-body">
									<div class="chart-area">
										<canvas data-bss-chart="{&quot;type&quot;:&quot;horizontalBar&quot;,&quot;data&quot;:{&quot;labels&quot;:[&quot;Caso 1&quot;,&quot;Caso 2&quot;,&quot;Caso 3&quot;,&quot;Caso 4&quot;,&quot;Caso 5&quot;,&quot;Caso 6&quot;],&quot;datasets&quot;:[{&quot;label&quot;:&quot;% Progreso&quot;,&quot;backgroundColor&quot;:&quot;#4e73df&quot;,&quot;borderColor&quot;:&quot;#4e73df&quot;,&quot;data&quot;:[&quot;68&quot;,&quot;35&quot;,&quot;100&quot;,&quot;26&quot;,&quot;78&quot;,&quot;82&quot;]}]},&quot;options&quot;:{&quot;maintainAspectRatio&quot;:false,&quot;legend&quot;:{&quot;display&quot;:false},&quot;title&quot;:{&quot;position&quot;:&quot;top&quot;},&quot;scales&quot;:{&quot;xAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;],&quot;drawOnChartArea&quot;:false},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;beginAtZero&quot;:true,&quot;padding&quot;:20}}],&quot;yAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;]},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;beginAtZero&quot;:true,&quot;padding&quot;:20}}]}}}"></canvas>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<%- include('./includes/footer')%>